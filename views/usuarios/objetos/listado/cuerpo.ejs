


  <div data-ng-controller="userListadoCtrl" class="w3-row ">
    <% for(var k in users)
    {
      var usuario=users[k];
    %>
    <article class="usuario nivel-<%= usuario.level %>  <% if (usuario.id==user.id){ %> me <% } %> ">



      <% if (usuario.level>1)
      {
      %>

      <% if(usuario.name){%><span class="nombre"><%= usuario.name %></span><%}%>
      <% if(usuario.surname){%><span class="apellido"><%= usuario.surname %></span><%}%>

      <%
      }
      %>

      <% if (!usuario.nombre && !usuario.apellido)
      {
        %>
     <span class="nombre">&nbsp;</span>
     <span class="apellido">&nbsp;</span>


      <%
      }
      %>

      <span class="nombreUsuario"><%= usuario.username %></span>


   <div class="actions">

     <% if(user.level >= publicData.canCreateUserLevel)
     {%>
        <a title="<%= __("editar") %>" href="/admin/usuario/<%= usuario.id %>" class="edit-usuario">
          <i class="material-icons">&#xE254;</i>
        </a>
    <%}%>

     <%if(user.level >= publicData.canDeleteUserLevel)
     {%>
     <a  title="<%= __("eliminar") %>" class="delete-usuario"
       <%
        if(user.id != usuario.id)
        {
        %>
         data-ng-click="deleteUsuario(<%= JSON.stringify(usuario)%>)"
       <%
       }
       else
       { %>
       data-disabled
       <%
       }%>
       >
       <i class="material-icons">&#xE872;</i>
     </a>
  <%}%>

   </div>


    </article>
    <%
    }
    %>
  </div>

  <script>

    app.controller('userListadoCtrl', function($rootScope,$http) {

      $rootScope.deleteUsuario=function(usuario)
      {
        console.log('delete');

        $http.delete('/user/'+usuario.id)
        .then(function(res) {

            console.log(res);
            location.reload();
          }, error);
      }

    });
  </script>
